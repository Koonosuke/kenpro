# ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦ã¨å½¹å‰²

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å±¤åˆ¥æ§‹æˆ

| å±¤ | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ä¸»ãªæ©Ÿèƒ½ |
|---|---|---|
| ãƒ‡ãƒã‚¤ã‚¹å±¤ | é‡é‡ã‚»ãƒ³ã‚µãƒ¼ + ãƒã‚¤ã‚³ãƒ³ (ESP32) | æŠ•æ£„æ¤œçŸ¥ â†’ IoT Coreã¸MQTTé€ä¿¡ |
| è¡¨ç¤ºå±¤ | ã‚µã‚¤ãƒãƒ¼ã‚¸ç«¯æœ« (Raspberry Pi) | Lambdaã‹ã‚‰å—ã‘å–ã£ãŸQRã‚’è¡¨ç¤º |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | Next.js (PWA) | QRã‚¹ã‚­ãƒ£ãƒ³ã€æ®‹é«˜ç¢ºèªã€ãƒã‚¤ãƒ³ãƒˆäº¤æ›ã€ãƒãƒƒãƒ—è¡¨ç¤º |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | API Gateway + Lambda (TypeScript) | QRç™ºè¡Œãƒ»æ¤œè¨¼ã€ãƒã‚¤ãƒ³ãƒˆåŠ ç®—ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç† |
| ãƒ‡ãƒ¼ã‚¿å±¤ | DynamoDB | users / qr_tokens / points_ledger / rewards / locations |
| èªè¨¼å±¤ | Cognito | ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¤ | AWS IoT Core | ã‚»ãƒ³ã‚µãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã®MQTTé€šä¿¡ |
| ç›£æŸ»/åˆ†æ | S3 + Athena | ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ä¿ç®¡ã¨ã‚¯ã‚¨ãƒªåˆ†æ |

## åˆ©ç”¨è€…ç›®ç·šã§ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ•ãƒ­ãƒ¼

### ğŸ‘¤ åˆ©ç”¨è€…ã®å…·ä½“çš„ãªä½“é¨“

**ç”°ä¸­ã•ã‚“ï¼ˆ30ä»£ä¼šç¤¾å“¡ï¼‰ã®ãƒªã‚µã‚¤ã‚¯ãƒ«ä½“é¨“**

1. **å‡ºå‹¤å‰ã®é§…ã§**
   - ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªã§æœ€å¯„ã‚Šã®ãƒªã‚µã‚¤ã‚¯ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‚’æ¤œç´¢
   - æ¸‹è°·é§…å‰ã®ãƒœãƒƒã‚¯ã‚¹ãŒåˆ©ç”¨å¯èƒ½ã¨è¡¨ç¤º

2. **ãƒªã‚µã‚¤ã‚¯ãƒ«ãƒœãƒƒã‚¯ã‚¹åˆ°ç€**
   - ãƒœãƒƒã‚¯ã‚¹ã«è¨­ç½®ã•ã‚ŒãŸICã‚«ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ã«Suicaã‚’ã‚¿ãƒƒãƒ
   - ã€Œèªè¨¼æˆåŠŸã€ã®éŸ³ã¨å…±ã«ãƒœãƒƒã‚¯ã‚¹ãŒé–‹éŒ 

3. **ãƒšãƒƒãƒˆãƒœãƒˆãƒ«æŠ•æ£„**
   - ç©ºã®ãƒšãƒƒãƒˆãƒœãƒˆãƒ«ã‚’æŠ•å…¥
   - ãƒœãƒƒã‚¯ã‚¹ãŒè‡ªå‹•ã§é–‰éŒ 

4. **ãƒã‚¤ãƒ³ãƒˆç²å¾—**
   - ã‚µã‚¤ãƒãƒ¼ã‚¸ã«QRã‚³ãƒ¼ãƒ‰ãŒ20ç§’é–“è¡¨ç¤º
   - ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªã§QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³
   - ã€Œ10ãƒã‚¤ãƒ³ãƒˆç²å¾—ï¼ã€ã®é€šçŸ¥ãŒè¡¨ç¤º

5. **ãƒã‚¤ãƒ³ãƒˆæ´»ç”¨**
   - ã‚¢ãƒ—ãƒªã§ãƒã‚¤ãƒ³ãƒˆæ®‹é«˜ã‚’ç¢ºèªï¼ˆç´¯è¨ˆ150ãƒã‚¤ãƒ³ãƒˆï¼‰
   - ã‚³ãƒ³ãƒ“ãƒ‹ã®å•†å“åˆ¸ï¼ˆ100ãƒã‚¤ãƒ³ãƒˆï¼‰ã¨äº¤æ›
   - æ®‹ã‚Š50ãƒã‚¤ãƒ³ãƒˆã§æ¬¡å›ã‚‚åˆ©ç”¨å¯èƒ½

### ğŸ¯ åˆ©ç”¨è€…ã®ä½“é¨“ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    A[åˆ©ç”¨è€…ãŒãƒªã‚µã‚¤ã‚¯ãƒ«ãƒœãƒƒã‚¯ã‚¹ã«åˆ°ç€] --> B[ICã‚«ãƒ¼ãƒ‰/ãƒ¢ãƒã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ã‚¿ãƒƒãƒ]
    B --> C{èªè¨¼æˆåŠŸï¼Ÿ}
    C -->|æˆåŠŸ| D[ãƒœãƒƒã‚¯ã‚¹ãŒé–‹éŒ ]
    C -->|å¤±æ•—| E[ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º]
    E --> B
    
    D --> F[ãƒšãƒƒãƒˆãƒœãƒˆãƒ«ã‚’æŠ•å…¥]
    F --> G[ãƒœãƒƒã‚¯ã‚¹ãŒé–‰éŒ ]
    G --> H[é‡é‡ã‚»ãƒ³ã‚µãƒ¼ãŒæ¤œçŸ¥]
    H --> I[ã‚µã‚¤ãƒãƒ¼ã‚¸ã«QRã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤º]
    I --> J[ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªã§QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³]
    J --> K[ãƒã‚¤ãƒ³ãƒˆãŒä»˜ä¸ã•ã‚Œã‚‹]
    K --> L[ãƒã‚¤ãƒ³ãƒˆæ®‹é«˜ã‚’ç¢ºèª]
    L --> M[æ™¯å“ã¨äº¤æ›å¯èƒ½]
    
    style A fill:#e1f5fe
    style K fill:#c8e6c9
    style M fill:#fff3e0
```

### ğŸ“± åˆ©ç”¨è€…ã®æ“ä½œç”»é¢ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart LR
    subgraph "ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªç”»é¢"
        A1[ãƒãƒƒãƒ—ç”»é¢<br/>æœ€å¯„ã‚Šã®ãƒªã‚µã‚¤ã‚¯ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‚’æ¤œç´¢]
        A2[QRã‚¹ã‚­ãƒ£ãƒ³ç”»é¢<br/>ã‚«ãƒ¡ãƒ©ã§QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚Š]
        A3[ãƒã‚¤ãƒ³ãƒˆä»˜ä¸å®Œäº†ç”»é¢<br/>ç²å¾—ãƒã‚¤ãƒ³ãƒˆã‚’è¡¨ç¤º]
        A4[ãƒã‚¤ãƒšãƒ¼ã‚¸<br/>ãƒã‚¤ãƒ³ãƒˆæ®‹é«˜ãƒ»å±¥æ­´ç¢ºèª]
        A5[æ™¯å“äº¤æ›ç”»é¢<br/>ãƒã‚¤ãƒ³ãƒˆã§æ™¯å“ã¨äº¤æ›]
    end
    
    A1 --> A2
    A2 --> A3
    A3 --> A4
    A4 --> A5
    A5 --> A1
    
    style A1 fill:#e3f2fd
    style A2 fill:#f3e5f5
    style A3 fill:#e8f5e8
    style A4 fill:#fff8e1
    style A5 fill:#fce4ec
```

### â±ï¸ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã§ã®åˆ©ç”¨ä½“é¨“

```mermaid
gantt
    title åˆ©ç”¨è€…ã®ãƒªã‚µã‚¤ã‚¯ãƒ«ä½“é¨“ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
    dateFormat X
    axisFormat %s
    
    section åˆ°ç€ãƒ»èªè¨¼
    ãƒªã‚µã‚¤ã‚¯ãƒ«ãƒœãƒƒã‚¯ã‚¹åˆ°ç€    :0, 10
    ICã‚«ãƒ¼ãƒ‰èªè¨¼            :10, 15
    ãƒœãƒƒã‚¯ã‚¹é–‹éŒ             :15, 20
    
    section æŠ•æ£„
    ãƒšãƒƒãƒˆãƒœãƒˆãƒ«æŠ•å…¥        :20, 30
    ãƒœãƒƒã‚¯ã‚¹é–‰éŒ             :30, 35
    é‡é‡æ¤œçŸ¥                :35, 40
    
    section ãƒã‚¤ãƒ³ãƒˆç²å¾—
    QRã‚³ãƒ¼ãƒ‰è¡¨ç¤º            :40, 60
    QRã‚¹ã‚­ãƒ£ãƒ³              :60, 70
    ãƒã‚¤ãƒ³ãƒˆä»˜ä¸            :70, 80
    
    section ç¢ºèªãƒ»äº¤æ›
    ãƒã‚¤ãƒ³ãƒˆç¢ºèª            :80, 90
    æ™¯å“äº¤æ›                :90, 120
```

### ğŸ’¡ åˆ©ç”¨è€…ã«ã¨ã£ã¦ã®ãƒ¡ãƒªãƒƒãƒˆ

| ãƒ¡ãƒªãƒƒãƒˆ | èª¬æ˜ | å…·ä½“ä¾‹ |
|----------|------|--------|
| **æ‰‹è»½ãªãƒªã‚µã‚¤ã‚¯ãƒ«** | é§…ã‚„è¡—ä¸­ã§ç°¡å˜ã«ãƒªã‚µã‚¤ã‚¯ãƒ«å¯èƒ½ | é€šå‹¤é€”ä¸­ã§ç©ºããƒšãƒƒãƒˆãƒœãƒˆãƒ«ã‚’å‡¦åˆ† |
| **ãƒã‚¤ãƒ³ãƒˆé‚„å…ƒ** | ãƒªã‚µã‚¤ã‚¯ãƒ«ã§ãƒã‚¤ãƒ³ãƒˆç²å¾— | 10å›åˆ©ç”¨ã§100ãƒã‚¤ãƒ³ãƒˆã€å•†å“åˆ¸ã¨äº¤æ› |
| **ç’°å¢ƒè²¢çŒ®** | ãƒªã‚µã‚¤ã‚¯ãƒ«æ´»å‹•ã¸ã®å‚åŠ  | æœˆ10å›åˆ©ç”¨ã§å¹´é–“120æœ¬ã®ãƒšãƒƒãƒˆãƒœãƒˆãƒ«ã‚’ãƒªã‚µã‚¤ã‚¯ãƒ« |
| **ä¾¿åˆ©ãªã‚¢ãƒ—ãƒª** | æœ€å¯„ã‚Šã®ãƒœãƒƒã‚¯ã‚¹æ¤œç´¢ãƒ»ãƒã‚¤ãƒ³ãƒˆç®¡ç† | ãƒãƒƒãƒ—ã§æœ€å¯„ã‚Šãƒœãƒƒã‚¯ã‚¹ã‚’æ¤œç´¢ã€å±¥æ­´ç¢ºèª |
| **å³åº§ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯** | QRã‚¹ã‚­ãƒ£ãƒ³ã§å³åº§ã«ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ | æŠ•æ£„å¾Œã™ãã«ãƒã‚¤ãƒ³ãƒˆç²å¾—ã‚’ç¢ºèª |

### ğŸ¯ ã‚·ã‚¹ãƒ†ãƒ ã®ä¾¡å€¤

**åˆ©ç”¨è€…è¦–ç‚¹**
- ãƒªã‚µã‚¤ã‚¯ãƒ«ãŒæ¥½ã—ãã€ç¶™ç¶šã—ã‚„ã™ã„
- ãƒã‚¤ãƒ³ãƒˆã§å®Ÿç”¨çš„ãªç‰¹å…¸ã‚’ç²å¾—
- ç’°å¢ƒæ´»å‹•ã¸ã®å‚åŠ æ„è­˜å‘ä¸Š

**ç¤¾ä¼šè¦–ç‚¹**
- è¡—ä¸­ã®ãƒªã‚µã‚¤ã‚¯ãƒ«ç‡å‘ä¸Š
- ãƒšãƒƒãƒˆãƒœãƒˆãƒ«ã®é©æ­£å‡¦ç†ä¿ƒé€²
- æŒç¶šå¯èƒ½ãªç¤¾ä¼šã®å®Ÿç¾

**äº‹æ¥­è€…è¦–ç‚¹**
- ãƒªã‚µã‚¤ã‚¯ãƒ«ãƒ‡ãƒ¼ã‚¿ã®åé›†ãƒ»åˆ†æ
- åˆ©ç”¨è€…ã®è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³æŠŠæ¡
- åŠ¹æœçš„ãªç’°å¢ƒæ–½ç­–ã®ç«‹æ¡ˆ

## ãƒªã‚µã‚¤ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ãƒ•ãƒ­ãƒ¼ï¼ˆæŠ€è¡“è©³ç´°ï¼‰

```mermaid
sequenceDiagram
    participant User as User
    participant IC as IC_Card
    participant Box as RecycleBox
    participant Sensor as WeightSensor
    participant AWS as IoT_Core
    participant Lambda as Lambda
    participant Signage as Signage
    participant App as UserApp
    participant DB as DynamoDB

    User->>IC_Card: "1. ICã‚«ãƒ¼ãƒ‰/ãƒ¢ãƒã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ã‚¿ãƒƒãƒ"
    IC_Card->>RecycleBox: "2. èªè¨¼æˆåŠŸ ãƒœãƒƒã‚¯ã‚¹é–‹éŒ "
    User->>RecycleBox: "3. ãƒšãƒƒãƒˆãƒœãƒˆãƒ«ã‚’æŠ•å…¥"
    RecycleBox->>WeightSensor: "4. é‡é‡å¤‰åŒ–ã‚’æ¤œçŸ¥"
    WeightSensor->>IoT_Core: "5. MQTTé€ä¿¡: ãƒªã‚µã‚¤ã‚¯ãƒ«æˆåŠŸ"
    IoT_Core->>Lambda: "6. IoT Rule ãƒˆãƒªã‚¬ãƒ¼"
    Lambda->>DynamoDB: "7. QRãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆãƒ»ä¿å­˜"
    Lambda->>Signage: "8. QRã‚³ãƒ¼ãƒ‰è¡¨ç¤º"
    User->>UserApp: "9. QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³"
    UserApp->>Lambda: "10. QRæ¤œè¨¼ãƒ»ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆ"
    Lambda->>DynamoDB: "11. ãƒã‚¤ãƒ³ãƒˆåŠ ç®—ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹åŒ–"
    Lambda->>UserApp: "12. ãƒã‚¤ãƒ³ãƒˆä»˜ä¸å®Œäº†"
    UserApp->>User: "13. æ™¯å“äº¤æ›å¯èƒ½"
```

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```mermaid
graph TD

subgraph "ãƒ¦ãƒ¼ã‚¶ãƒ¼å´"
  U1["Next.js PWA<br/>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒ—ãƒª"]
  U2["QRã‚¹ã‚­ãƒ£ãƒ³ / æ®‹é«˜ / äº¤æ› / ãƒãƒƒãƒ—è¡¨ç¤º"]
  U3["ICã‚«ãƒ¼ãƒ‰/ãƒ¢ãƒã‚¤ãƒ«ãƒ‘ã‚¹"]
end

subgraph "ã‚µã‚¤ãƒãƒ¼ã‚¸ç«¯æœ«"
  D1["Raspberry Pi<br/>ã‚µã‚¤ãƒãƒ¼ã‚¸è¡¨ç¤ºç«¯æœ«"]
  D2["QRè¡¨ç¤ºUI<br/>Next.js or Node.js"]
end

subgraph "ãƒªã‚µã‚¤ã‚¯ãƒ«ãƒœãƒƒã‚¯ã‚¹"
  B1["ICã‚«ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼<br/>NFC/éæ¥è§¦"]
  B2["é–‹éŒ æ©Ÿæ§‹<br/>ã‚µãƒ¼ãƒœãƒ¢ãƒ¼ã‚¿ãƒ¼"]
  B3["é‡é‡ã‚»ãƒ³ã‚µãƒ¼<br/>ãƒ­ãƒ¼ãƒ‰ã‚»ãƒ« or HX711"]
  B4["ãƒã‚¤ã‚³ãƒ³<br/>ESP32ç­‰"]
  B5["AWS IoT SDK<br/>MQTT Publish"]
  B1 --> B2
  B3 --> B4 --> B5
end

subgraph "AWSã‚¯ãƒ©ã‚¦ãƒ‰"
  A1["AWS IoT Core<br/>MQTTãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼"]
  A2["IoT Rule<br/>ãƒˆãƒªã‚¬ãƒ¼"]
  A3["Lambda: recycle_handler<br/>QRç™ºè¡Œãƒ»ä¿å­˜"]
  A4["API Gateway<br/>HTTP API"]
  A5["Lambda: qr_redeem<br/>ç½²åæ¤œè¨¼ãƒ»ãƒã‚¤ãƒ³ãƒˆä»˜ä¸"]
  A6["DynamoDB<br/>users / qr_tokens / points_ledger / rewards / locations"]
  A7["Cognito<br/>èªè¨¼ ãƒ¦ãƒ¼ã‚¶ãƒ¼/ç®¡ç†è€…"]
  A8["S3 + Athena<br/>ç›£æŸ»ãƒ­ã‚°ãƒ»é›†è¨ˆåˆ†æ"]
  A1 --> A2 --> A3
  A4 --> A5
  A3 --> A6
  A5 --> A6
  A5 --> A8
  A4 --> A7
end

subgraph "ç®¡ç†è€…"
  M1["Next.js ç®¡ç†ç”»é¢<br/>QRç™ºè¡Œãƒ»åˆ©ç”¨çµ±è¨ˆ"]
end

%% ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
U3 -->|"ICã‚«ãƒ¼ãƒ‰/ãƒ¢ãƒã‚¤ãƒ«ãƒ‘ã‚¹èªè¨¼"| B1
B1 -->|"èªè¨¼æˆåŠŸ"| B2
B3 -->|"é‡é‡å¤‰åŒ–æ¤œçŸ¥"| B4
B5 -->|"MQTT publish<br/>/recycle/success"| A1
A3 -->|"ç”Ÿæˆã•ã‚ŒãŸQRæƒ…å ±"| D1
U1 -->|"QRã‚¹ã‚­ãƒ£ãƒ³â†’/qr/redeem"| A4
M1 -->|"QRç™ºè¡ŒAPI"| A4
A5 -->|"ãƒã‚¤ãƒ³ãƒˆåŠ ç®—"| A6
U1 -->|"æ®‹é«˜ãƒ»äº¤æ›æƒ…å ±å–å¾—"| A4
```

## å®Ÿè£…ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ï¼ˆç°¡ç•¥ç‰ˆï¼‰

```mermaid
graph TD

subgraph "ãƒ¦ãƒ¼ã‚¶ãƒ¼å´"
  U1["Next.js PWA<br/>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒ—ãƒª"]
  U2["QRã‚¹ã‚­ãƒ£ãƒ³ / æ®‹é«˜ / äº¤æ› / ãƒãƒƒãƒ—è¡¨ç¤º"]
end

subgraph "ãƒªã‚µã‚¤ã‚¯ãƒ«ãƒœãƒƒã‚¯ã‚¹ï¼ˆç°¡ç•¥ç‰ˆï¼‰"
  B1["é‡é‡ã‚»ãƒ³ã‚µãƒ¼<br/>ãƒ­ãƒ¼ãƒ‰ã‚»ãƒ« or HX711"]
  B2["ãƒã‚¤ã‚³ãƒ³<br/>ESP32ç­‰"]
  B3["AWS IoT SDK<br/>MQTT Publish"]
  B1 --> B2 --> B3
end

subgraph "ã‚µã‚¤ãƒãƒ¼ã‚¸ç«¯æœ«"
  D1["Raspberry Pi<br/>ã‚µã‚¤ãƒãƒ¼ã‚¸è¡¨ç¤ºç«¯æœ«"]
  D2["QRè¡¨ç¤ºUI<br/>Next.js"]
  D3["WebSocketæ¥ç¶š<br/>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°"]
  D2 --> D3
end

subgraph "AWSã‚¯ãƒ©ã‚¦ãƒ‰"
  A1["AWS IoT Core<br/>MQTTãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼"]
  A2["IoT Rule<br/>ãƒˆãƒªã‚¬ãƒ¼"]
  A3["Lambda: recycle_handler<br/>QRç”Ÿæˆãƒ»ä¿å­˜"]
  A4["API Gateway<br/>HTTP API"]
  A5["Lambda: qr_redeem<br/>QRæ¤œè¨¼ãƒ»ãƒã‚¤ãƒ³ãƒˆä»˜ä¸"]
  A6["DynamoDB<br/>ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆ"]
  A7["Cognito<br/>ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼"]
  A8["S3 + Athena<br/>ãƒ­ã‚°ãƒ»åˆ†æ"]
  A9["WebSocket API<br/>ã‚µã‚¤ãƒãƒ¼ã‚¸é€šä¿¡"]
  A1 --> A2 --> A3
  A4 --> A5
  A3 --> A6
  A5 --> A6
  A5 --> A8
  A4 --> A7
  A3 --> A9
end

subgraph "ç®¡ç†è€…"
  M1["Next.js ç®¡ç†ç”»é¢<br/>çµ±è¨ˆãƒ»è¨­å®šç®¡ç†"]
end

%% ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
B3 -->|"MQTT: /recycle/success"| A1
A3 -->|"WebSocket: QRè¡¨ç¤º"| D3
A3 -->|"QRä¿å­˜"| A6
U1 -->|"QRã‚¹ã‚­ãƒ£ãƒ³â†’/qr/redeem"| A4
A5 -->|"ãƒã‚¤ãƒ³ãƒˆåŠ ç®—"| A6
U1 -->|"æ®‹é«˜ãƒ»äº¤æ›æƒ…å ±å–å¾—"| A4
M1 -->|"ç®¡ç†API"| A4
```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆï¼ˆDynamoDBï¼‰

| ãƒ†ãƒ¼ãƒ–ãƒ«å | ä¸»ã‚­ãƒ¼ | å±æ€§ | ç”¨é€” |
|---|---|---|---|
| **users** | user_id (String) | email, name, points_balance, created_at, updated_at | ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãƒ»ãƒã‚¤ãƒ³ãƒˆæ®‹é«˜ |
| **qr_tokens** | token_id (String) | user_id, location_id, points_value, expires_at, status, created_at | QRãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç† |
| **points_ledger** | transaction_id (String) | user_id, points_change, transaction_type, qr_token_id, created_at | ãƒã‚¤ãƒ³ãƒˆå–å¼•å±¥æ­´ |
| **rewards** | reward_id (String) | name, description, points_cost, stock_count, is_active, created_at | æ™¯å“ãƒã‚¹ã‚¿ |
| **locations** | location_id (String) | name, address, coordinates, is_active, created_at | ãƒªã‚µã‚¤ã‚¯ãƒ«ãƒœãƒƒã‚¯ã‚¹è¨­ç½®å ´æ‰€ |
| **recycle_events** | event_id (String) | location_id, weight_detected, qr_token_id, created_at | ãƒªã‚µã‚¤ã‚¯ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚° |

## å®Ÿç¾æŠ€è¡“è©³ç´°

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **Next.js 14**: App Routerã€Server Components
- **PWA**: Service Workerã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ
- **QRã‚¹ã‚­ãƒ£ãƒ³**: `@zxing/library`ã€ã‚«ãƒ¡ãƒ©API
- **çŠ¶æ…‹ç®¡ç†**: Zustand
- **UI**: Tailwind CSS + shadcn/ui

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **API Gateway**: HTTP API v2ã€CORSè¨­å®š
- **Lambda**: TypeScriptã€Node.js 18.x
- **èªè¨¼**: Cognito User Poolã€JWT
- **WebSocket**: API Gateway WebSocket API

### IoTãƒ»ãƒ‡ãƒã‚¤ã‚¹
- **ESP32**: Arduino IDEã€WiFiæ¥ç¶š
- **é‡é‡ã‚»ãƒ³ã‚µãƒ¼**: HX711 + ãƒ­ãƒ¼ãƒ‰ã‚»ãƒ«
- **MQTT**: AWS IoT Device SDK
- **Raspberry Pi**: Node.jsã€WebSocketæ¥ç¶š

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **DynamoDB**: ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰èª²é‡‘ã€GSIæ´»ç”¨
- **S3**: ãƒ­ã‚°ä¿å­˜ã€é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
- **Athena**: ãƒ­ã‚°åˆ†æã€SQLã‚¯ã‚¨ãƒª

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **æš—å·åŒ–**: AES-256ã€HTTPS/WSS
- **èªè¨¼**: JWTã€API Key
- **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: IAM Roleã€æœ€å°æ¨©é™
